<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>100% coverage or not | Halbow&#39;s  blog</title>
<meta name="keywords" content="">
<meta name="description" content="üßµThe debate Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering. For some people it&rsquo;s very well worth the time to test everything while some other argue that it&rsquo;s not worthwile to invest that much time and that some 80% or 90% is good enough. While it&rsquo;s clearly a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently had to start a new project from scratch and asked myself the question: should I bother to aim for 100% coverage or should I settle for an arbitrary threshold like 90% ?">
<meta name="author" content="">
<link rel="canonical" href="https://halbow.me/posts/coverage/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://halbow.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://halbow.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://halbow.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://halbow.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://halbow.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://halbow.me/posts/coverage/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="100% coverage or not" />
<meta property="og:description" content="üßµThe debate Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering. For some people it&rsquo;s very well worth the time to test everything while some other argue that it&rsquo;s not worthwile to invest that much time and that some 80% or 90% is good enough. While it&rsquo;s clearly a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently had to start a new project from scratch and asked myself the question: should I bother to aim for 100% coverage or should I settle for an arbitrary threshold like 90% ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://halbow.me/posts/coverage/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-01T08:10:43+02:00" />
<meta property="article:modified_time" content="2024-05-01T08:10:43+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="100% coverage or not"/>
<meta name="twitter:description" content="üßµThe debate Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering. For some people it&rsquo;s very well worth the time to test everything while some other argue that it&rsquo;s not worthwile to invest that much time and that some 80% or 90% is good enough. While it&rsquo;s clearly a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently had to start a new project from scratch and asked myself the question: should I bother to aim for 100% coverage or should I settle for an arbitrary threshold like 90% ?"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://halbow.me/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "100% coverage or not",
      "item": "https://halbow.me/posts/coverage/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "100% coverage or not",
  "name": "100% coverage or not",
  "description": "üßµThe debate Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering. For some people it\u0026rsquo;s very well worth the time to test everything while some other argue that it\u0026rsquo;s not worthwile to invest that much time and that some 80% or 90% is good enough. While it\u0026rsquo;s clearly a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently had to start a new project from scratch and asked myself the question: should I bother to aim for 100% coverage or should I settle for an arbitrary threshold like 90% ?",
  "keywords": [
    
  ],
  "articleBody": "üßµThe debate Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering. For some people it‚Äôs very well worth the time to test everything while some other argue that it‚Äôs not worthwile to invest that much time and that some 80% or 90% is good enough. While it‚Äôs clearly a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently had to start a new project from scratch and asked myself the question: should I bother to aim for 100% coverage or should I settle for an arbitrary threshold like 90% ? But before answering the question let‚Äôs discuss about coverage ü§ì\nüìñ 100% coverage is not the holy grail of testing First thing we have to clarify is that most of the time, when a library or a application claims to have 100% code coverage, they mean 100% line/statement coverage. What this means is that the tests ran over all the line/statements in the codebase. The difference between a line and a statement is quite minimal, only in some case, this can make the computation of the percentage vary a bit, consider this example:\ndef some_function(flag): do_something();print(\"Finished\") With statement coverage it will correctly notice that the tests run over (or didn‚Äôt) two statements and not only one line ! This has probably more impact in other language as in Python this pretty rare to arraneg code this way (and to use semi colon üòÅ)\n‚ö†Ô∏è Limitations of (statement) coverage While 100% statement coverage is nice, there‚Äôs a few cases where it can have suprising result:\ndef weird_div(flag=True): a = 0 if flag: a += 1 return 1 / a This snippet will pass with 100% statement coverage if called with weird_div() but will fail if you call weird_div(False) ! With coverage you can enable branch coverage to make sure your tests run over the main branches/paths of your code. This will catch simple usecases like this where the code jumps conditionnaly over a few lines of code.\nWhile 100% branch coverage is clearly indicates that you have a good coverage of the code, this doesn‚Äôt mean that the code is not buggy and unfortunately as soon as you start to have some more complex usecase, coverage will not save you. You can find a bunch of example of the limitations of branch coverage here.\nüíØ Why you should aim for 100% coverage report The main reason I like to keep 100% branch coverage in my project (and enforce it in the CI) is not really for the existing codebase but for all the future code that will be written. When you settle for an arbitrary threshold like 80%, while this is a pretty good metric for the existing codebase, this means that you only require the new code to be tested at 80%. A new merge request adding 100 statements that only tests 80 of it would be likely to pass this.\nOne could argue that 100% coverage is still un-neccessary work because maybe the engineer decided that it wasn‚Äôt worth it to test these 2 functions and that with 100% coverage the engineer would spend time writing test just for the coverage to pass. The problem with this is that you don‚Äôt really know if it‚Äôs a conscious choice or an oversight from the engineers when doing the review. And if you do, you certainly won‚Äôt in 6 months.\nIMO the best of both world is 100% coverage report. This doesn‚Äôt mean you have to test all the lines of code but that you report needs to stay at 100%. With a big incentive to ignore all the lines/files/functions you don‚Äôt want to test. This means you don‚Äôt have to spend the time writting useless tests to reach the coverage but you are forced to think about it. And this make the choice not to test some function/part of the code explicit.\n",
  "wordCount" : "657",
  "inLanguage": "en",
  "datePublished": "2024-05-01T08:10:43+02:00",
  "dateModified": "2024-05-01T08:10:43+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://halbow.me/posts/coverage/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Halbow's  blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://halbow.me/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://halbow.me/" accesskey="h" title="Halbow&#39;s  blog (Alt + H)">Halbow&#39;s  blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      100% coverage or not
    </h1>
    <div class="post-meta"><span title='2024-05-01 08:10:43 +0200 CEST'>May 1, 2024</span>

</div>
  </header> 
  <div class="post-content"><h1 id="the-debate">üßµThe debate<a hidden class="anchor" aria-hidden="true" href="#the-debate">#</a></h1>
<p>Whether targeting 100% coverage is worth it or not has been a long discussion in Software Engineering.
For some people it&rsquo;s very well worth the time to test everything while some other argue that it&rsquo;s
not worthwile to invest that much time and that some 80% or 90% is good enough. While it&rsquo;s clearly
a significant amount of work to reach this kind of threshold on a legacy/non-trivial codebase, I recently
had to start a new project from scratch and asked myself the question: should I bother to aim for 100%
coverage or should I settle for an arbitrary threshold like 90% ? But before answering the question let&rsquo;s
discuss about coverage ü§ì</p>
<h1 id="-100-coverage-is-not-the-holy-grail-of-testing">üìñ 100% coverage is not the holy grail of testing<a hidden class="anchor" aria-hidden="true" href="#-100-coverage-is-not-the-holy-grail-of-testing">#</a></h1>
<p>First thing we have to clarify is that most of the time, when a library or a application
claims to have 100% code coverage, they mean 100% line/statement coverage. What this means is that
the tests ran over all the line/statements in the codebase. The difference between a line and a statement
is quite minimal, only in some case, this can make the computation of the percentage vary a bit, consider this example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">some_function</span>(flag):
</span></span><span style="display:flex;"><span>    do_something();print(<span style="color:#e6db74">&#34;Finished&#34;</span>)
</span></span></code></pre></div><p>With statement coverage it will correctly notice that the tests run over (or didn&rsquo;t)
two statements and not only one line ! This has probably more impact in other language
as in Python this pretty rare to arraneg code this way (and to use semi colon üòÅ)</p>
<h2 id="-limitations-of-statement-coverage">‚ö†Ô∏è Limitations of (statement) coverage<a hidden class="anchor" aria-hidden="true" href="#-limitations-of-statement-coverage">#</a></h2>
<p>While 100% statement coverage is nice, there&rsquo;s a few cases where it can have suprising result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">weird_div</span>(flag<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> flag:
</span></span><span style="display:flex;"><span>       a <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> a
</span></span></code></pre></div><p>This snippet will pass with 100% statement coverage if called with <code>weird_div()</code> but will fail if you call <code>weird_div(False)</code> !
With <a href="https://coverage.readthedocs.io/en/7.5.0/">coverage</a> you can enable branch coverage to make sure your tests run over the main branches/paths of your code.
This will catch simple usecases like this where the code jumps conditionnaly over a few lines of code.</p>
<p>While 100% branch coverage is clearly indicates that you have a good coverage of the code, this doesn&rsquo;t mean
that the code is not buggy and unfortunately as soon as you start to have some more complex usecase, coverage will
not save you. You can find a bunch of example of the limitations of branch coverage <a href="https://nedbatchelder.com/blog/200710/flaws_in_coverage_measurement.html">here</a>.</p>
<h1 id="-why-you-should-aim-for-100-coverage-report">üíØ Why you should aim for 100% coverage report<a hidden class="anchor" aria-hidden="true" href="#-why-you-should-aim-for-100-coverage-report">#</a></h1>
<p>The main reason I like to keep 100% branch coverage in my project (and enforce it in the CI) is not really for
the existing codebase but for all the future code that will be written. When you settle for an arbitrary threshold
like 80%, while this is a pretty good metric for the existing codebase, this means that you only require the new
code to be tested at 80%. A new merge request adding 100 statements that only tests 80 of it would be likely to pass this.</p>
<p>One could argue that 100% coverage is still un-neccessary work because maybe the engineer decided that it wasn&rsquo;t worth it
to test these 2 functions and that with 100% coverage the engineer would spend time writing test just for the coverage to pass.
The problem with this is that you don&rsquo;t really know if it&rsquo;s a conscious choice or an oversight from the engineers when doing the review.
And if you do, you certainly won&rsquo;t in 6 months.</p>
<p>IMO the best of both world is 100% coverage <strong>report</strong>. This doesn&rsquo;t mean you have to test all the lines of code but that
you report needs to stay at 100%. With a big incentive to ignore all the lines/files/functions you don&rsquo;t
want to test. This means you don&rsquo;t have to spend the time writting useless tests to reach the coverage but you are forced
to think about it. And this make the choice not to test some function/part of the code explicit.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://halbow.me/">Halbow&#39;s  blog</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
